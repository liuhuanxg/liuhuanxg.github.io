<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>code review总结 | devin's blog</title><meta name="author" content="devin"><meta name="copyright" content="devin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言作为公司代码委员会golang分会的理事，作为(还未任命)的技术leader，我review了很多代码，看了很多别人的review评论。发现，即使是委员会的委员，code review的水品，写出好代码的水品，不乏缺乏根本性的思路、设计原则的同学。特此，想分享一下我的很多理念和思路。 为什么技术人员包括leader都要做code review​        谚语曰: ‘Talk Is Che">
<meta property="og:type" content="article">
<meta property="og:title" content="code review总结">
<meta property="og:url" content="http://example.com/2023/04/28/TreasureBox/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/code%20review%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="devin&#39;s blog">
<meta property="og:description" content="前言作为公司代码委员会golang分会的理事，作为(还未任命)的技术leader，我review了很多代码，看了很多别人的review评论。发现，即使是委员会的委员，code review的水品，写出好代码的水品，不乏缺乏根本性的思路、设计原则的同学。特此，想分享一下我的很多理念和思路。 为什么技术人员包括leader都要做code review​        谚语曰: ‘Talk Is Che">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-04-28T10:40:04.882Z">
<meta property="article:modified_time" content="2023-04-28T10:44:49.053Z">
<meta property="article:author" content="devin">
<meta property="article:tag" content="开源">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/04/28/TreasureBox/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/code%20review%E6%80%BB%E7%BB%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'code review总结',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-28 18:44:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="devin's blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">151</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="devin's blog"><span class="site-name">devin's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">code review总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-28T10:40:04.882Z" title="发表于 2023-04-28 18:40:04">2023-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-28T10:44:49.053Z" title="更新于 2023-04-28 18:44:49">2023-04-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="code review总结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>作为公司代码委员会golang分会的理事，作为(还未任命)的技术leader，我review了很多代码，看了很多别人的review评论。发现，即使是委员会的委员，code review的水品，写出好代码的水品，不乏缺乏根本性的思路、设计原则的同学。特此，想分享一下我的很多理念和思路。</p>
<h1 id="为什么技术人员包括leader都要做code-review"><a href="#为什么技术人员包括leader都要做code-review" class="headerlink" title="为什么技术人员包括leader都要做code review"></a>为什么技术人员包括leader都要做code review</h1><p>​        谚语曰: ‘Talk Is Cheap, Show Me The Code’。知易行难，知行合一难。嘴里要讲出来总是轻松，把别人讲过的话记住，组织一下语言，再讲出来，很容易。绝知此事要躬行。设计理念你可能道听途说了一些，以为自己掌握了，但是你会做么？有能力去思考、改进自己当前的实践方式和实践中的代码细节么？不客气地说，很多人仅仅是知道并且认同了某个设计理念，进而产生了一种虚假的安心感—自己的技术并不差。但是，他根本没有去实践这些设计理念，甚至根本实践不了这些设计理念，从结果来说，他懂不懂这些道理&#x2F;理念，有什么差别？变成了自欺欺人。</p>
<p>​        代码，是设计理念落地的地方，是技术的呈现和根本。同学们可以在review过程中做到落地沟通，不再是空对空的讨论，可以在实际问题中产生思考的碰撞，互相学习，大家都掌握团队里积累出来最好的实践方式！当然，如果leader没时间写代码，仅仅是review代码，指出其他同学某些实践方式不好，要给出好的实践的意见，即使没亲手写代码，也是对最佳实践要有很多思考。</p>
<h1 id="为什么同学们要在review中思考和总结最佳实践"><a href="#为什么同学们要在review中思考和总结最佳实践" class="headerlink" title="为什么同学们要在review中思考和总结最佳实践"></a>为什么同学们要在review中思考和总结最佳实践</h1><p>我这里先给一个我自己的总结：所谓架构师，就是掌握大量设计理念和原则、落地到各种语言及附带工具链（生态）下的实践方法、垂直行业模型理解，定制系统模型设计和工程实践规范细则。进而控制30+万行代码项目的开发便利性、可维护性、可测试性、运营质量。</p>
<p>接着，有一些同学就说了，张小龙老板是厉害的技术人，他是这样的人么？阿里巴巴的王坚是厉害的CTO，他懂golang、c++、java么？接着，我这里拓展讲解一下，我们和他们的不同。我的总结，厉害的技术人，主要可以分为下面几个方向：</p>
<ul>
<li><p>奇技淫巧</p>
<p>掌握很多技巧，以及发现技巧一系列思路，比如很多编程大赛，比的就是这个。但是，这个对工程，用处好像并不是很大。</p>
</li>
<li><p>领域奠基</p>
</li>
</ul>
<p>  比如约翰*卡马克，他创造出了现代计算机图形高效渲染的方法论。不论如果没有他，后面会不会有人发明，他就是第一个发明了。1999年，卡马克登上了美国时代杂志评选出来的科技领域50大影响力人物榜单，并且名列第10位。但是，类似的殿堂级位置，没有几个，不够大家分，没我们的事儿。</p>
<ul>
<li>理论研究</li>
</ul>
<p>  八十年代李开复博士坚持采用隐含马尔可夫模型的框架，成功地开发了世界上第一个大词汇量连续语音识别系统Sphinx。我辈工程师，好像擅长这个的很少。</p>
<ul>
<li>产品成功</li>
</ul>
<p>  小龙哥，不解释，同学们应该也做不到。</p>
<ul>
<li>最佳实践</li>
</ul>
<p>  这个是大家都可以做到，按照上面架构师的定义。在这条路上走得好，就能为任何公司组件技术团队，组织建设高质量的系统。</p>
<p>从上面的讨论中，可以看出，我们普通工程师的进化之路，就是不断打磨最佳实践方法论、落地细节。</p>
<h1 id="代码变坏的根源"><a href="#代码变坏的根源" class="headerlink" title="代码变坏的根源"></a>代码变坏的根源</h1><p>在讨论什么代码是好代码之前，我们先讨论什么是不好的。计算机是人造的学科，我们自己制造了很多问题，进而去思考解法。</p>
<h2 id="重复的代码"><a href="#重复的代码" class="headerlink" title="重复的代码"></a>重复的代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BatchGetQQTinyWithAdmin 获取QQ uin的tinyID, 需要主uin的tiny和登录态</span></span><br><span class="line"><span class="comment">// friendUins 可以是空列表, 只要admin uin的tiny</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BatchGetQQTinyWithAdmin</span><span class="params">(ctx context.Context, adminUin <span class="type">uint64</span>, friendUin []<span class="type">uint64</span>)</span></span> (</span><br><span class="line">	adminTiny <span class="type">uint64</span>, sig []<span class="type">byte</span>, frdTiny <span class="keyword">map</span>[<span class="type">uint64</span>]<span class="type">uint64</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> friendAccountList []*basedef.AccountInfo</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> friendUin &#123;</span><br><span class="line">		friendAccountList = <span class="built_in">append</span>(friendAccountList, &amp;basedef.AccountInfo&#123;</span><br><span class="line">			AccountType: proto.String(def.StrQQU),</span><br><span class="line">			Userid:      proto.String(fmt.Sprint(v)),</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	req := &amp;cmd0xb91.ReqBody&#123;</span><br><span class="line">		Appid:       proto.Uint32(model.DocAppID),</span><br><span class="line">		CheckMethod: proto.String(CheckQQ),</span><br><span class="line">		AdminAccount: &amp;basedef.AccountInfo&#123;</span><br><span class="line">			AccountType: proto.String(def.StrQQU),</span><br><span class="line">			Userid:      proto.String(fmt.Sprint(adminUin)),</span><br><span class="line">		&#125;,</span><br><span class="line">		FriendAccountList: friendAccountList,</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>因为最开始协议设计得不好，第一个使用接口的人，没有类似上面这个函数的代码，自己实现了一个嵌入逻辑代码的填写请求结构结构体的代码，一开始，挺好的。但当有第二个人，第三个人干了类似的事情，我们将无法再重构这个协议，必须做到麻烦的向前兼容。而且每个同学，都要理解一遍上面这个协议怎么填，理解有问题，就触发bug。或者，如果某个错误的理解，普遍存在，我们就得找到所有这些重复的片段，都修改一遍。</p>
<p>当你要读一个数据，发现两个地方有，不知道该选择哪个。当你要实现一个功能，发现两个rpc接口、两个函数能做到，你不知道选哪一个。你有面临过这样的’人生难题’么？其实怎么选并不重要了，你写的这个代码已经在走向shit的道路上迈出了坚实的一步。</p>
<p>但是，A little copying is better than a little dependency。这里提一嘴，不展开。</p>
<p>这里，我必须额外说一句。大家使用trpc。感觉自己被鼓励’每个服务搞一个git’。那，你这个服务里访问db的代码，rpc的代码，各种可以复用的代码，是用的大家都复用的git下的代码么？每次都重复写一遍，db字段细节改了，每个使用过db的server对应的git都改一遍？这个通用git已经写好的接口应该不知道哪些git下的代码因为自己不向前兼容的修改而永远放弃了向前不兼容的修改？</p>
<h2 id="早期有效的决策不再有效"><a href="#早期有效的决策不再有效" class="headerlink" title="早期有效的决策不再有效"></a>早期有效的决策不再有效</h2><p>很多时候，我们第一版代码写出来，是没有太大的问题的。比如，下面这个代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Update 增量更新</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *FilePrivilegeStore)</span></span> Update(key def.PrivilegeKey,</span><br><span class="line">	clear, isMerge <span class="type">bool</span>, subtract []*access.AccessInfo, increment []*access.AccessInfo,</span><br><span class="line">	policy *<span class="type">uint32</span>, adv *access.AdvPolicy, shareKey <span class="type">string</span>, importQQGroupID <span class="type">uint64</span>) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="comment">// 获取之前的数据</span></span><br><span class="line">	info, err := s.Get(key)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	incOnlyModify := update(info, &amp;key, clear, subtract, </span><br><span class="line">		increment, policy, adv, shareKey, importQQGroupID)</span><br><span class="line">	stat := statAndUpdateAccessInfo(info)</span><br><span class="line">	<span class="keyword">if</span> !incOnlyModify &#123;</span><br><span class="line">		<span class="keyword">if</span> stat.groupNumber &gt; model.FilePrivilegeGroupMax &#123;</span><br><span class="line">			<span class="keyword">return</span> errors.Errorf(errors.PrivilegeGroupLimit, </span><br><span class="line">				<span class="string">&quot;group num %d larger than limit %d&quot;</span>,</span><br><span class="line">				stat.groupNumber, model.FilePrivilegeGroupMax)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !isMerge &#123;</span><br><span class="line">		<span class="keyword">if</span> key.DomainID == <span class="type">uint64</span>(access.SPECIAL_FOLDER_DOMAIN_ID) &amp;&amp;</span><br><span class="line">			<span class="built_in">len</span>(info.AccessInfos) &gt; model.FilePrivilegeMaxFolderNum &#123;</span><br><span class="line">			<span class="keyword">return</span> errors.Errorf(errors.PrivilegeFolderLimit, </span><br><span class="line">				<span class="string">&quot;folder owner num %d larger than limit %d&quot;</span>,</span><br><span class="line">				<span class="built_in">len</span>(info.AccessInfos), model.FilePrivilegeMaxFolderNum)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(info.AccessInfos) &gt; model.FilePrivilegeMaxNum &#123;</span><br><span class="line">			<span class="keyword">return</span> errors.Errorf(errors.PrivilegeUserLimit, </span><br><span class="line">				<span class="string">&quot;file owner num %d larger than limit %d&quot;</span>,</span><br><span class="line">				<span class="built_in">len</span>(info.AccessInfos), model.FilePrivilegeMaxNum)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	pbDataSt := infoToData(info, &amp;key)</span><br><span class="line">	<span class="keyword">var</span> updateBuf []<span class="type">byte</span></span><br><span class="line">	<span class="keyword">if</span> updateBuf, err = proto.Marshal(pbDataSt); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Wrapf(err, errors.MarshalPBError,</span><br><span class="line">			<span class="string">&quot;FilePrivilegeStore.Update Marshal data error, key[%v]&quot;</span>, key)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err = s.setCKV(generateKey(&amp;key), updateBuf); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Wrapf(err, errors.Code(err),</span><br><span class="line">			<span class="string">&quot;FilePrivilegeStore.Update setCKV error, key[%v]&quot;</span>, key)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在看，这个代码挺好的，长度没超过80行，逻辑比价清晰。但是当isMerge这里判断逻辑，如果加入更多的逻辑，把局部行数撑到50行以上，这个函数，味道就坏了。出现两个问题：</p>
<p>1）函数内代码不在一个逻辑层次上，阅读代码，本来在阅读着顶层逻辑，突然就掉入了长达50行的isMerge的逻辑处理细节，还没看完，读者已经忘了前面的代码讲了什么，需要来回看，挑战自己大脑的cache尺寸。</p>
<p>2）代码有问题后，再新加代码的同学，是改还是不改前人写好的代码呢？要不要往里面填屎，堆屎山呢？出bug谁来背？这是一个灵魂拷问。</p>
<h2 id="过早的优化"><a href="#过早的优化" class="headerlink" title="过早的优化"></a>过早的优化</h2><p>这个大家听了很多了，这里不赘述。</p>
<h2 id="对合理性没有苛求"><a href="#对合理性没有苛求" class="headerlink" title="对合理性没有苛求"></a>对合理性没有苛求</h2><p>‘两种写法都ok，你随便挑一种吧’，’我这样也没什么吧’，这是我经常听到的话。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get 获取IP</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *IPGetter)</span></span> Get(cardName <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">	i.l.RLock()</span><br><span class="line">	ip, found := i.m[cardName]</span><br><span class="line">	i.l.RUnlock()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> found &#123;</span><br><span class="line">		<span class="keyword">return</span> ip</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	i.l.Lock()</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	ip, err = getNetIP(cardName)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		i.m[cardName] = ip</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  i.l.Unlock()</span><br><span class="line">	<span class="keyword">return</span> ip</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>i.l.Unlock()可以放在当前的位置，也可以放在i.l.Lock()下面，做成defer。两种在最初构造的时候，好像都行。这个时候，很多同学态度就变得不坚决。实际上，这里必须是defer的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> i.l.Lock()</span><br><span class="line"><span class="keyword">defer</span> i.l.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">ip, err = getNetIP(cardName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i.m[cardName] = ip</span><br><span class="line"><span class="keyword">return</span> ip</span><br></pre></td></tr></table></figure>

<p>这样的修改，是极有可能发生的，它还是要变成defer，那，为什么不一开始就是defer，进入最合理的状态？不一开始就进入最合理的状态，在后续协作种，其他同学很可能犯错！</p>
<p>##总是面向对象&#x2F;总喜欢封装</p>
<p>我是软件工程科班出身。学的第一门编程预言是c++。教材是<a target="_blank" rel="noopener" href="https://book.douban.com/subject/1112255/">这本</a> 。当时自己读完教材，初入程序设计之门，对于里面讲的’封装’，惊为天人，多么美妙的设计啊，面向对象，多么智慧的设计啊。但是，这些年来，我看到了大牛’云风’对于’毕业生使用mysql api就喜欢搞个class封装再用’的嘲讽；看到了各种莫名其妙的class定义；体会到了经常要去看一个莫名其妙的继承树，必须要把整个继承树整体读明白才能确认一个细小的逻辑分支；多次体会到了我需要辛苦地压抑住自己的抵触情绪，去细度一个自作聪明的被封装的代码，确认我的bug。除了UI类场景，我认为少用继承、多用组合。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">_PKG_TYPE</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSuperAction</span> : <span class="keyword">public</span> CSuperActionBase &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> _PKG_TYPE pkg_type;</span><br><span class="line">    <span class="keyword">typedef</span> CSuperAction&lt;pkg_type&gt; this_type;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是sspp的代码。CSuperAction和CSuperActionBase，一会儿super，一会儿又base，Super和SuperBase是在怎样的两个抽象层次上，不通读代码，没人能读明白。我想确认任何细节，都要把多个层次的代码都通读了，有什么封装性可言？</p>
<p>好，你说是作者没有把class name取得好。那，问题是，你能取得好么？一个刚入职的T1.2的同学能把class name、class树设计得好么？即使是对简单的业务模型，也需要无数次’坏’的对象抽象实践，才能培养出一个具有合格的class抽象能力的同学，这对于大型却松散的团队协作，不是破坏性的？已经有了一套继承树，想要添加功能就只能在这个继承树里添加，以前的继承树不再适合新的需求，这个继承树上所有的class，以及使用它们的地方，你都去改？不，是个正常人都会放弃，开始堆屎山。</p>
<p>封装，就是我可以不关心实现。但是，做一个稳定的系统，每一层设计都可能出问题。abi，总有合适的用法和不合适的用法，真的存在我们能完全不关心封装的部分是怎么实现的？不，你不能。bug和性能问题，常常就出现在，你用了错误的用法去使用一个封装好的函数。即使是android、ios的api，golang、java现成的api，我们常常都要去探究实现，才能把api用好。那，我们是不是该一上来，就做一个透明性很强的函数，才更为合理？使用者想知道细节，进来吧，我的实现很易读，你看看就明白，使用时不会迷路！对于逻辑复杂的函数，我们还要强调函数内部工作方式’可以让读者在大脑里想象呈现完整过程’的可显性，让使用者轻松读懂，有把握，使用时，不迷路！</p>
<h2 id="根本没有设计"><a href="#根本没有设计" class="headerlink" title="根本没有设计"></a>根本没有设计</h2><p>这个最可怕，所有需求，上手就是一顿撸，’设计是什么东西？我一个文件5w行，一个函数5k行，干不完需求？’从第一行代码开始，就是无设计的，随意地踩着满地的泥坑，对于旁人的眼光没有感觉，一个人独舞，产出的代码，完成了需求，毁灭了接手自己代码的人本该用来啪啪啪的夜晚~ 这个就不举例了，每个同学应该都能在自己的项目类发现这种代码。</p>
<h1 id="必须形而上的思考"><a href="#必须形而上的思考" class="headerlink" title="必须形而上的思考"></a>必须形而上的思考</h1><p>常常，同学们听演讲，公开课，就喜欢听一些细枝末节的’干活’。这没有问题。但是，你干了几年活，学习了多少干货知识点？构建起自己的技术思考’面’，进入立体的’工程思维’，把技术细节和系统要满足的需求在思考上连接起来了么？当听一个需求的时候，你能思考到自己的code package该怎么组织，函数该怎么组织了么？我相信，在腾讯，大多数人没做到，不客气地说，即使是很多T4。</p>
<p>那，技术点要怎么和需求连接起来呢？答案很简单，你需要在时间里总结，总结出一些明确的原则、思维过程。思考怎么去总结，特别像是在思考哲学问题。从一些琐碎的细节中，由具体情况上升到一些原则、公理。同时，大家在接受原则时，不应该是接受和记住原则本身，而应该是结构原则，让这个原则在自己这里重新推理一遍，自己完全掌握这个原则的适用范围。</p>
<p>再进一步具体地说，对于工程最佳实践的形而上的思考过程，就是：</p>
<p>把工程实践中遇到的问题，从问题类型和解法类型，两个角度去归类，总结出一些有限适用的原则，就从点到了面。把诸多总结出的原则，组合应用到自己的项目代码中，就是把多个面结合起来构建了一套立体的最佳实践的方案。当你这套方案能适应30w+行代码的项目，超过30人的项目，你就架构师入门了！当你这个项目，是多端，多语言，代码量超过300w行，参与人数超过300人，代码质量依然很高，代码依然在高效地自我迭代，每天消除掉过时的代码，填充高质量的替换旧代码和新生的代码。恭喜你，你已经是一个很高级的架构师了！再进一步，你对某个业务模型有独到或者全面的理解，构建了一套行业第一的解决方案，结合刚才高质量实现的能力，实现了这么一个项目。没啥好说的，你已经是专家工程师了。级别再高，我就不了解了，不在这里讨论。</p>
<p>那么，我们要重头开始积累思考和总结？不，有一本书叫做&lt;unix编程艺术&gt;，我在不同的时期分别读了3遍，等一会，我讲一些里面提到的，我觉得在腾讯尤其值得拿出来说的原则。这些原则，正好就能作为code review时大家判定代码质量的准绳。但，在那之前，我得讲一下另外一个很重要的话题，模型设计。</p>
<h1 id="model设计"><a href="#model设计" class="headerlink" title="model设计"></a>model设计</h1><p>没读过oauth2.0 RFC，就去设计第三方授权登陆的人，终归还要再发明一个撇脚的oauth。</p>
<p>2012年我刚毕业，我和一个去了广州联通公司的华南理工毕业生聊天。当时他说他工作很不开心，因为工作里 不经常写代码，而且认为自己，有ACM竞赛金牌级的算法熟练度+对CPP代码的熟悉，写下一个个指针操作内存，什么程序写不出来，什么事情做不好。当时我觉得，挺有道理，编程工具在手，我什么事情做不了？</p>
<p>现在，我会告诉他，复杂如linux操作系统、Chromium引擎、windows office，你做不了。原因是，他根本没进入软件工程的工程世界。不是会搬砖就能修出港珠澳大桥。但是，这么回答并不好，举证用的论据离我们太遥远了。见微知著。我现在会回答，你做不了，简单如一个权限系统，你知道怎么做么？堆积一堆逻辑层次一维展开的ifelse？简单如一个共享文件管理，你知道怎么做么？堆积一堆逻辑层次一维展开的ifelse？你联通有上完台服务器，你要怎么写一个管理平台？堆积一堆逻辑层次一维展开的ifelse？</p>
<p>上来就是干，能实现上面提到的三个看似简单的需求？想一想，亚马逊、阿里云折腾了多少年，最后才找到了容器+Kubernetes的大杀器。这里，需要谷歌多少年在BORG系统上的实践，提出了优秀的服务编排领域模型。权限领域，有RBAC、DAC、MAC等等模型，到了业务，又会有细节的不同。如Domain Driven Design说的，没有良好的领域思考和模型抽象，逻辑复杂度就是n^2指数级的，你得写多少ifelse，得思考多少可能的if路径，来cover所有的不合符预期的情况。你必须要有Domain思考探索、model拆解&#x2F;抽象&#x2F;构建的能力。有人问过我，要怎么有效地获得这个能力？这个问题我没能回答，就像是在问我，怎么才能获得MIT博士的学术能力？我无法回答。唯一回答就是，进入某个领域，就是首先去看前人的思考，站在前人的肩膀上，再用上自己的通识能力，去进一步思考。至于怎么建立好的通识思考能力，可能得去常青藤读个书吧：）或者，就在工程实践中思考和锻炼自己的这个能力！</p>
<p>同时，基于model设计的代码，能更好地适应产品经理不断变更的需求。比如说，一个calendar(日历)应用，简单来想，不要太简单！以’userid_date’为key记录一个用户的每日安排不就完成了么？只往前走一步，设计了一个任务，上限分发给100w个人，创建这么一个任务，是往100w个人下面添加一条记录？你得改掉之前的设计，换db。再往前走一步，要拉出某个用户和某个人一起要参与的所有事务，是把两个人的所有任务来做join？好像还行。如果是和100个人一起参与的所有任务呢？100个人的任务来join？不现实了吧。好，你引入一个群组id，那么，你最开始的’userid_date’为key的设计，是不是又要修改和做数据迁移了？经常来一个需求，你就得把系统推翻重来，或者根本就只能拒绝用户的需求，这样的战斗力，还好意思叫自己工程师？你一开始就应该思考自己面对的业务领域，思考自己的日历应用可能的模型边界，把可能要做的能力都拿进来思考，构建一个model，设计一套通用的store层接口，基于通用接口的逻辑代码。当产品不断发展，就是不停往模型里填内容，而不是推翻重来。这，思考模型边界，构建模型细节，就是两个很重要的能力，也是绝大多数腾讯产品经理不具备的能力，你得具备，对整个团队都是极其有益的。你面对产品经理时，就听取他们出于对用户体验负责思考出的需求点，到你自己这里，用一个完整的模型去涵盖这些零碎的点。</p>
<p>model设计，是形而上思考中的一个方面，一个特别重要的方面。接下来，我们来抄袭抄袭unix操作系统构建的实践为我们提出的前人实践经验和’公理’总结。在自己的coding&#x2F;code review中，站在巨人的肩膀上去思考。不重复地发现经典力学，而是往相对论挺进。</p>
<h1 id="UNIX设计哲学"><a href="#UNIX设计哲学" class="headerlink" title="UNIX设计哲学"></a>UNIX设计哲学</h1><p>不懂Unix的人注定最终还要重复发明一个撇脚的Unix。–Henry Spenncer, 1987.11</p>
<p>下面这一段话太经典，我必须要摘抄一遍(自《UNIX编程艺术》)：<br>“工程和设计的每个分支都有自己的技术文化。在大多数工程领域中，就一个专业人员的素养组成来说，有些不成文的行业素养具有与标准手册及教科书同等重要的地位(并且随着专业人员经验的日积月累，这些经验常常会比书本更重要)。资深工程师们在工作中会积累大量的隐性知识，他们用类似禅宗’教外别传’的方式，通过言传身教传授给后辈。<br>软件工程算是此规则的一个例外：技术变革如此之快，软件环境日新月异，软件技术文化暂如朝露。然而，例外之中也有例外。确有极少数软件技术被证明经久耐用，足以演进为强势的技术文化、有鲜明特色的艺术和世代相传的设计哲学。“</p>
<p>接下来，我用我的理解，讲解一下几个我们常常做不到的原则。</p>
<h2 id="Keep-It-Simple-Stuped"><a href="#Keep-It-Simple-Stuped" class="headerlink" title="Keep It Simple Stuped!"></a>Keep It Simple Stuped!</h2><p>KISS原则，大家应该是如雷贯耳了。但是，你真的在遵守？什么是Simple？简单？golang语言主要设计者之一的Rob Pike说’大道至简’，这个’简’和简单是一个意思么？</p>
<p>首先，简单不是面对一个问题，我们印入眼帘第一映像的解法为简单。我说一句，感受一下。”把一个事情做出来容易，把事情用最简单有效的方法做出来，是一个很难的事情。”比如，做一个三方授权，oauth2.0很简单，所有概念和细节都是紧凑、完备、易用的。你觉得要设计到oauth2.0这个效果很容易么？要做到简单，就要对自己处理的问题有全面的了解，然后需要不断积累思考，才能做到从各个角度和层级去认识这个问题，打磨出一个通俗、紧凑、完备的设计，就像ios的交互设计。简单不是容易做到的，需要大家在不断的时间和code review过程中去积累思考，pk中触发思考，交流中总结思考，才能做得愈发地好，接近’大道至简’。</p>
<p>两张经典的模型图，简单又全面，感受一下，没看懂，可以立即自行google学习一下：<br>RBAC:<br><img src="../../resource/pic/common_privilege.png" alt="avatar" style="zoom:50%;" title="rbac"/><br>logging:<br><img src="../../resource/pic/logging.png" alt="avatar" style="zoom:50%;" title="logging"/></p>
<h2 id="原则3-组合原则-设计时考虑拼接组合"><a href="#原则3-组合原则-设计时考虑拼接组合" class="headerlink" title="原则3 组合原则: 设计时考虑拼接组合"></a>原则3 组合原则: 设计时考虑拼接组合</h2><p>关于OOP，关于继承，我前面已经说过了。那我们怎么组织自己的模块？对，用组合的方式来达到。linux操作系统离我们这么近，它是怎么架构起来的？往小里说，我们一个串联一个业务请求的数据集合，如果使用BaseSession，XXXSession inherit BaseSession的设计，其实，这个继承树，很难适应层出不穷的变化。但是如果使用组合，就可以拆解出UserSignature等等各种可能需要的部件，在需要的时候组合使用，不断添加新的部件而没有对老的继承树的记忆这个心智负担。</p>
<p>使用组合，其实就是要让你明确清楚自己现在所拥有的是哪个部件。如果部件过于多，其实完成组合最终成品这个步骤，就会有较高的心智负担，每个部件展开来，琳琅满目，眼花缭乱。比如QT这个通用UI框架，看它的<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/classes.html">Class列表</a>，有1000多个。如果不用继承树把它组织起来，平铺展开，组合出一个页面，将会变得心智负担高到无法承受。OOP在’需要无数元素同时展现出来’这种复杂度极高的场景，有效的控制了复杂度 。’那么，古尔丹，代价是什么呢？’代价就是，一开始做出这个自上而下的设计，牵一发而动全身，每次调整都变得异常困难。实际项目中，各种职业级别不同的同学一起协作修改一个server的代码，就会出现，职级低的同学改哪里都改不对，根本没能力进行修改，高级别的同学能修改对，也不愿意大规模修改，整个项目变得愈发不合理。对整个继承树没有完全认识的同学都没有资格进行任何一个对继承树有调整的修改，协作变得寸步难行。代码的修改，都变成了依赖一个高级架构师高强度监控继承体系的变化，低级别同学们束手束脚的结果。组合，就很好的解决了这个问题，把问题不断细分，每个同学都可以很好地攻克自己需要攻克的点，实现一个package。产品逻辑代码，只需要去组合各个package，就能达到效果。</p>
<p>这是golang标准库里http request的定义，它就是Http请求所有特性集合出来的结果。其中通用&#x2F;异变&#x2F;多种实现的部分，通过duck interface抽象，比如Body io.ReadCloser。你想知道哪些细节，就从组合成request的部件入手，要修改，只需要修改对应部件。[这段代码后，对比.NET的HTTP基于OOP的抽象]</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Request represents an HTTP request received by a server</span></span><br><span class="line"><span class="comment">// or to be sent by a client.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The field semantics differ slightly between client and server</span></span><br><span class="line"><span class="comment">// usage. In addition to the notes on the fields below, see the</span></span><br><span class="line"><span class="comment">// documentation for Request.Write and RoundTripper.</span></span><br><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Method specifies the HTTP method (GET, POST, PUT, etc.).</span></span><br><span class="line">	<span class="comment">// For client requests, an empty string means GET.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Go&#x27;s HTTP client does not support sending a request with</span></span><br><span class="line">	<span class="comment">// the CONNECT method. See the documentation on Transport for</span></span><br><span class="line">	<span class="comment">// details.</span></span><br><span class="line">	Method <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// URL specifies either the URI being requested (for server</span></span><br><span class="line">	<span class="comment">// requests) or the URL to access (for client requests).</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For server requests, the URL is parsed from the URI</span></span><br><span class="line">	<span class="comment">// supplied on the Request-Line as stored in RequestURI.  For</span></span><br><span class="line">	<span class="comment">// most requests, fields other than Path and RawQuery will be</span></span><br><span class="line">	<span class="comment">// empty. (See RFC 7230, Section 5.3)</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, the URL&#x27;s Host specifies the server to</span></span><br><span class="line">	<span class="comment">// connect to, while the Request&#x27;s Host field optionally</span></span><br><span class="line">	<span class="comment">// specifies the Host header value to send in the HTTP</span></span><br><span class="line">	<span class="comment">// request.</span></span><br><span class="line">	URL *url.URL</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The protocol version for incoming server requests.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, these fields are ignored. The HTTP</span></span><br><span class="line">	<span class="comment">// client code always uses either HTTP/1.1 or HTTP/2.</span></span><br><span class="line">	<span class="comment">// See the docs on Transport for details.</span></span><br><span class="line">	Proto      <span class="type">string</span> <span class="comment">// &quot;HTTP/1.0&quot;</span></span><br><span class="line">	ProtoMajor <span class="type">int</span>    <span class="comment">// 1</span></span><br><span class="line">	ProtoMinor <span class="type">int</span>    <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Header contains the request header fields either received</span></span><br><span class="line">	<span class="comment">// by the server or to be sent by the client.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// If a server received a request with header lines,</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//	Host: example.com</span></span><br><span class="line">	<span class="comment">//	accept-encoding: gzip, deflate</span></span><br><span class="line">	<span class="comment">//	Accept-Language: en-us</span></span><br><span class="line">	<span class="comment">//	fOO: Bar</span></span><br><span class="line">	<span class="comment">//	foo: two</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// then</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//	Header = map[string][]string&#123;</span></span><br><span class="line">	<span class="comment">//		&quot;Accept-Encoding&quot;: &#123;&quot;gzip, deflate&quot;&#125;,</span></span><br><span class="line">	<span class="comment">//		&quot;Accept-Language&quot;: &#123;&quot;en-us&quot;&#125;,</span></span><br><span class="line">	<span class="comment">//		&quot;Foo&quot;: &#123;&quot;Bar&quot;, &quot;two&quot;&#125;,</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For incoming requests, the Host header is promoted to the</span></span><br><span class="line">	<span class="comment">// Request.Host field and removed from the Header map.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// HTTP defines that header names are case-insensitive. The</span></span><br><span class="line">	<span class="comment">// request parser implements this by using CanonicalHeaderKey,</span></span><br><span class="line">	<span class="comment">// making the first character and any characters following a</span></span><br><span class="line">	<span class="comment">// hyphen uppercase and the rest lowercase.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, certain headers such as Content-Length</span></span><br><span class="line">	<span class="comment">// and Connection are automatically written when needed and</span></span><br><span class="line">	<span class="comment">// values in Header may be ignored. See the documentation</span></span><br><span class="line">	<span class="comment">// for the Request.Write method.</span></span><br><span class="line">	Header Header</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Body is the request&#x27;s body.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, a nil body means the request has no</span></span><br><span class="line">	<span class="comment">// body, such as a GET request. The HTTP Client&#x27;s Transport</span></span><br><span class="line">	<span class="comment">// is responsible for calling the Close method.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For server requests, the Request Body is always non-nil</span></span><br><span class="line">	<span class="comment">// but will return EOF immediately when no body is present.</span></span><br><span class="line">	<span class="comment">// The Server will close the request body. The ServeHTTP</span></span><br><span class="line">	<span class="comment">// Handler does not need to.</span></span><br><span class="line">	Body io.ReadCloser</span><br><span class="line"></span><br><span class="line">	<span class="comment">// GetBody defines an optional func to return a new copy of</span></span><br><span class="line">	<span class="comment">// Body. It is used for client requests when a redirect requires</span></span><br><span class="line">	<span class="comment">// reading the body more than once. Use of GetBody still</span></span><br><span class="line">	<span class="comment">// requires setting Body.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For server requests, it is unused.</span></span><br><span class="line">	GetBody <span class="function"><span class="keyword">func</span><span class="params">()</span></span> (io.ReadCloser, <span class="type">error</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ContentLength records the length of the associated content.</span></span><br><span class="line">	<span class="comment">// The value -1 indicates that the length is unknown.</span></span><br><span class="line">	<span class="comment">// Values &gt;= 0 indicate that the given number of bytes may</span></span><br><span class="line">	<span class="comment">// be read from Body.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, a value of 0 with a non-nil Body is</span></span><br><span class="line">	<span class="comment">// also treated as unknown.</span></span><br><span class="line">	ContentLength <span class="type">int64</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TransferEncoding lists the transfer encodings from outermost to</span></span><br><span class="line">	<span class="comment">// innermost. An empty list denotes the &quot;identity&quot; encoding.</span></span><br><span class="line">	<span class="comment">// TransferEncoding can usually be ignored; chunked encoding is</span></span><br><span class="line">	<span class="comment">// automatically added and removed as necessary when sending and</span></span><br><span class="line">	<span class="comment">// receiving requests.</span></span><br><span class="line">	TransferEncoding []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Close indicates whether to close the connection after</span></span><br><span class="line">	<span class="comment">// replying to this request (for servers) or after sending this</span></span><br><span class="line">	<span class="comment">// request and reading its response (for clients).</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For server requests, the HTTP server handles this automatically</span></span><br><span class="line">	<span class="comment">// and this field is not needed by Handlers.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, setting this field prevents re-use of</span></span><br><span class="line">	<span class="comment">// TCP connections between requests to the same hosts, as if</span></span><br><span class="line">	<span class="comment">// Transport.DisableKeepAlives were set.</span></span><br><span class="line">	Close <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// For server requests, Host specifies the host on which the</span></span><br><span class="line">	<span class="comment">// URL is sought. For HTTP/1 (per RFC 7230, section 5.4), this</span></span><br><span class="line">	<span class="comment">// is either the value of the &quot;Host&quot; header or the host name</span></span><br><span class="line">	<span class="comment">// given in the URL itself. For HTTP/2, it is the value of the</span></span><br><span class="line">	<span class="comment">// &quot;:authority&quot; pseudo-header field.</span></span><br><span class="line">	<span class="comment">// It may be of the form &quot;host:port&quot;. For international domain</span></span><br><span class="line">	<span class="comment">// names, Host may be in Punycode or Unicode form. Use</span></span><br><span class="line">	<span class="comment">// golang.org/x/net/idna to convert it to either format if</span></span><br><span class="line">	<span class="comment">// needed.</span></span><br><span class="line">	<span class="comment">// To prevent DNS rebinding attacks, server Handlers should</span></span><br><span class="line">	<span class="comment">// validate that the Host header has a value for which the</span></span><br><span class="line">	<span class="comment">// Handler considers itself authoritative. The included</span></span><br><span class="line">	<span class="comment">// ServeMux supports patterns registered to particular host</span></span><br><span class="line">	<span class="comment">// names and thus protects its registered Handlers.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, Host optionally overrides the Host</span></span><br><span class="line">	<span class="comment">// header to send. If empty, the Request.Write method uses</span></span><br><span class="line">	<span class="comment">// the value of URL.Host. Host may contain an international</span></span><br><span class="line">	<span class="comment">// domain name.</span></span><br><span class="line">	Host <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Form contains the parsed form data, including both the URL</span></span><br><span class="line">	<span class="comment">// field&#x27;s query parameters and the PATCH, POST, or PUT form data.</span></span><br><span class="line">	<span class="comment">// This field is only available after ParseForm is called.</span></span><br><span class="line">	<span class="comment">// The HTTP client ignores Form and uses Body instead.</span></span><br><span class="line">	Form url.Values</span><br><span class="line"></span><br><span class="line">	<span class="comment">// PostForm contains the parsed form data from PATCH, POST</span></span><br><span class="line">	<span class="comment">// or PUT body parameters.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// This field is only available after ParseForm is called.</span></span><br><span class="line">	<span class="comment">// The HTTP client ignores PostForm and uses Body instead.</span></span><br><span class="line">	PostForm url.Values</span><br><span class="line"></span><br><span class="line">	<span class="comment">// MultipartForm is the parsed multipart form, including file uploads.</span></span><br><span class="line">	<span class="comment">// This field is only available after ParseMultipartForm is called.</span></span><br><span class="line">	<span class="comment">// The HTTP client ignores MultipartForm and uses Body instead.</span></span><br><span class="line">	MultipartForm *multipart.Form</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Trailer specifies additional headers that are sent after the request</span></span><br><span class="line">	<span class="comment">// body.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For server requests, the Trailer map initially contains only the</span></span><br><span class="line">	<span class="comment">// trailer keys, with nil values. (The client declares which trailers it</span></span><br><span class="line">	<span class="comment">// will later send.)  While the handler is reading from Body, it must</span></span><br><span class="line">	<span class="comment">// not reference Trailer. After reading from Body returns EOF, Trailer</span></span><br><span class="line">	<span class="comment">// can be read again and will contain non-nil values, if they were sent</span></span><br><span class="line">	<span class="comment">// by the client.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For client requests, Trailer must be initialized to a map containing</span></span><br><span class="line">	<span class="comment">// the trailer keys to later send. The values may be nil or their final</span></span><br><span class="line">	<span class="comment">// values. The ContentLength must be 0 or -1, to send a chunked request.</span></span><br><span class="line">	<span class="comment">// After the HTTP request is sent the map values can be updated while</span></span><br><span class="line">	<span class="comment">// the request body is read. Once the body returns EOF, the caller must</span></span><br><span class="line">	<span class="comment">// not mutate Trailer.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Few HTTP clients, servers, or proxies support HTTP trailers.</span></span><br><span class="line">	Trailer Header</span><br><span class="line"></span><br><span class="line">	<span class="comment">// RemoteAddr allows HTTP servers and other software to record</span></span><br><span class="line">	<span class="comment">// the network address that sent the request, usually for</span></span><br><span class="line">	<span class="comment">// logging. This field is not filled in by ReadRequest and</span></span><br><span class="line">	<span class="comment">// has no defined format. The HTTP server in this package</span></span><br><span class="line">	<span class="comment">// sets RemoteAddr to an &quot;IP:port&quot; address before invoking a</span></span><br><span class="line">	<span class="comment">// handler.</span></span><br><span class="line">	<span class="comment">// This field is ignored by the HTTP client.</span></span><br><span class="line">	RemoteAddr <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// RequestURI is the unmodified request-target of the</span></span><br><span class="line">	<span class="comment">// Request-Line (RFC 7230, Section 3.1.1) as sent by the client</span></span><br><span class="line">	<span class="comment">// to a server. Usually the URL field should be used instead.</span></span><br><span class="line">	<span class="comment">// It is an error to set this field in an HTTP client request.</span></span><br><span class="line">	RequestURI <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TLS allows HTTP servers and other software to record</span></span><br><span class="line">	<span class="comment">// information about the TLS connection on which the request</span></span><br><span class="line">	<span class="comment">// was received. This field is not filled in by ReadRequest.</span></span><br><span class="line">	<span class="comment">// The HTTP server in this package sets the field for</span></span><br><span class="line">	<span class="comment">// TLS-enabled connections before invoking a handler;</span></span><br><span class="line">	<span class="comment">// otherwise it leaves the field nil.</span></span><br><span class="line">	<span class="comment">// This field is ignored by the HTTP client.</span></span><br><span class="line">	TLS *tls.ConnectionState</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Cancel is an optional channel whose closure indicates that the client</span></span><br><span class="line">	<span class="comment">// request should be regarded as canceled. Not all implementations of</span></span><br><span class="line">	<span class="comment">// RoundTripper may support Cancel.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// For server requests, this field is not applicable.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Deprecated: Set the Request&#x27;s context with NewRequestWithContext</span></span><br><span class="line">	<span class="comment">// instead. If a Request&#x27;s Cancel field and context are both</span></span><br><span class="line">	<span class="comment">// set, it is undefined whether Cancel is respected.</span></span><br><span class="line">	Cancel &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Response is the redirect response which caused this request</span></span><br><span class="line">	<span class="comment">// to be created. This field is only populated during client</span></span><br><span class="line">	<span class="comment">// redirects.</span></span><br><span class="line">	Response *Response</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ctx is either the client or server context. It should only</span></span><br><span class="line">	<span class="comment">// be modified via copying the whole Request using WithContext.</span></span><br><span class="line">	<span class="comment">// It is unexported to prevent people from using Context wrong</span></span><br><span class="line">	<span class="comment">// and mutating the contexts held by callers of the same request.</span></span><br><span class="line">	ctx context.Context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看看<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.description.webhttpendpoint?view=netframework-4.8#definition">.NET里对于web服务的抽象</a>，仅仅看到末端，不去看完整个继承树的完整图景，我根本无法知道我关心的某个细节在什么位置。进而，我要往整个http服务体系里修改任何功能，都无法抛开对整体完整设计的理解和熟悉，还极容易没有知觉地破坏者整体的设计。</p>
<p>说到组合，还有一个关系很紧密的词，叫插件化。大家都用vscode用得很开心，它比visual studio成功在哪里？如果vscode通过添加一堆插件达到visual studio具备的能力，那么它将变成另一个和 visual studio差不多的东西，叫做vs studio吧。大家应该发现问题了，我们很多时候其实并不需要visual studio的大多数功能，而且希望灵活定制化一些比较小众的能力，用一些小众的插件。甚至，我们希望选择不同实现的同类型插件。这就是组合的力量，各种不同的组合，它简单，却又满足了各种需求，灵活多变，要实现一个插件，不需要事先掌握一个庞大的体系。体现在代码上，也是一样的道理。至少后端开发领域，组合，比OOP，’香’很多。</p>
<h2 id="原则6-吝啬原则-除非确无它法-不要编写庞大的程序"><a href="#原则6-吝啬原则-除非确无它法-不要编写庞大的程序" class="headerlink" title="原则6 吝啬原则: 除非确无它法, 不要编写庞大的程序"></a>原则6 吝啬原则: 除非确无它法, 不要编写庞大的程序</h2><p>“大”，是男性们的一致追求。”大”的系统，才能拿得出手去评T11、T12。于是，我们总倾向于把系(肚)统(子)搞大。一个T5的同学做一个服务，也总要搞”大”一点，才好意思拉leader们来评审自己的方案。leader们一看方案，很大，很好，很全面。但是，真的需要这么大么？</p>
<p>我又要说了”那么，古尔丹，代价是什么呢？”。代价是代码越多，越难维护，难调整。C语言之父Ken Thompson说”删除一行代码，给我带来的成就感要比添加一行要大”。我们对于代码，要吝啬。能把系统做小，就不要做大。腾讯不乏200w+行的客户端，很大，很”牛逼”。但是，同学们自问，现在还调整得动架构么。手Q的同学们，看看自己代码，曾经叹息过么。能小做的事情就小做，寻求通用化，通过duck interface(甚至多进程，用于隔离能力的多线程)把模块、能力隔离开，时刻想着删减代码量，才能保持代码的可维护性和面对未来的需求、架构，调整自身的活力。客户端代码，UI渲染模块可以复杂吊炸天，非UI部分应该追求最简单，能力接口化，可替换、重组合能力强。</p>
<p>落地到大家的代码，review时，就应该最关注核心struct定义，构建起一个完备的模型，核心interface，明确抽象model对外部的依赖，明确抽象model对外提供的能力。其他代码，就是要用最简单、平平无奇的代码实现模型内部细节。</p>
<h2 id="原则7-透明性原则-设计要可见，以便审查和调试"><a href="#原则7-透明性原则-设计要可见，以便审查和调试" class="headerlink" title="原则7 透明性原则: 设计要可见，以便审查和调试"></a>原则7 透明性原则: 设计要可见，以便审查和调试</h2><p>首先，定义一下，什么是透明性和可显性。</p>
<p>“如果没有阴暗的角落和隐藏的深度，软件系统就是透明的。透明性是一种被动的品质。如果实际上能预测到程序行为的全部或大部分情况，并能建立简单的心理模型，这个程序就是透明的，因为可以看透机器究竟在干什么。</p>
<p>如果软件系统所包含的功能是为了帮助人们对软件建立正确的’做什么、怎么做’的心理模型而设计，这个软件系统就是可显的。因此，举例来说，对用户而言，良好的文档有助于提高可显性；对程序员而言，良好的变量和函数名有助于提高可显性。可显性是一种主动品质。在软件种要达到这一点，仅仅做到不晦涩是不够的，还必须要尽力做到有帮助。”</p>
<p>我们要写好程序，减少bug，就要增强自己对代码的控制力。你始终做到，理解自己调用的函数&#x2F;复用的代码大概是怎么实现的。不然，你可能就会在单线程状态机的server里调用有IO阻塞的函数，让自己的server吞吐量直接掉到底。进而，为了保证大家能对自己代码能做到有控制力，所有人写的函数，就必须具备很高的透明性。而不是写一些看了一阵看不明白的函数&#x2F;代码，结果被迫使用你代码的人，直接放弃了对掌控力的追去，甚至放弃复用你的代码，另起炉灶，走线了’制造重复代码’的深渊。</p>
<p>透明性其实相对容易做到的，大家有意识地锻炼一两个月，就能做得很好。可显性就不容易了。有一个现象是，你写的每一个函数都不超过80行，每一行我都能看懂，但是你层层调用，很多函数调用，组合起来怎么就实现了某个功能，看两遍，还是看不懂。第三遍可能才能大概看懂。大概看懂了，但太复杂，很难在大脑里构建起你实现这个功能的整体流程。结果就是，阅读者根本做不到对你的代码有好的掌控力。</p>
<p>可显性的标准很简单，大家看一段代码，懂不懂，一下就明白了。但是，如何做好可显性？那就是要追求合理的函数分组，合理的函数上下级层次，同一层次的代码才会出现在同一个函数里，追求通俗易懂的函数分组分层方式，是通往可显性的道路。</p>
<p>当然，复杂如linux操作系统，office文档，问题本身就很复杂，拆解、分层、组合得再合理，都难简历心理模型。这个时候，就需要完备的文档了。完备的文档还需要出现在离代码最近的地方，让人’知道这里复杂的逻辑有文档’，而不是其实文档，但是阅读者不知道。再看看上面golang标准库里的http.Request，感受到它在可显性上的努力了么？对，就去学它。</p>
<h2 id="原则10-通俗原则-接口设计避免标新立异"><a href="#原则10-通俗原则-接口设计避免标新立异" class="headerlink" title="原则10 通俗原则: 接口设计避免标新立异"></a>原则10 通俗原则: 接口设计避免标新立异</h2><p>程序员啊，我们不仅喜欢”大”。我们还喜欢”吊”，我们就是要与众不同，才显得自己厉害。然而，标新立异，就提升了别人理解的难度。</p>
<p>一般，我们这么定义一个’点’，使用x表示横坐标，用y表示纵坐标：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	X <span class="type">float64</span></span><br><span class="line">	Y <span class="type">float64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你就是要不同、精准：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	VerticalOrdinate   <span class="type">float64</span></span><br><span class="line">	HorizontalOrdinate <span class="type">float64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很好，你用词很精准，一般人还驳斥不了你。但是，多数人读你的VerticalOrdinate就是没有读X理解来得快，来得容易懂、方便。你是在刻意制造协作成本。</p>
<p>上面的例子常见，但还不是最小立异原则最想说明的问题。想想一下，一个程序里，你把用’+’这个符号表示数组添加元素，而不是数学’加’，’result :&#x3D; 1+2’ –&gt; ‘result &#x3D; []int{1, 2}’而不是’result&#x3D;3’，那么，你这个标新立异，对程序的破坏性，简直无法想象。<br>“最小立异原则的另一面是避免表象想死而实际却略有不同。这会极端危险，因为表象相似往往导致人们产生错误的假定。所以最好让不同事物有明显区别，而不要看起来几乎一模一样。” – Henry Spencer。</p>
<p>你实现一个db.Add()函数却做着db.AddOrUpdate()的操作，有人使用了你的接口，错误地把数据覆盖了。小心以后有人扎小人来诅咒你。</p>
<h2 id="原则11-缄默原则-如果一个程序没什么好说的，就沉默"><a href="#原则11-缄默原则-如果一个程序没什么好说的，就沉默" class="headerlink" title="原则11 缄默原则: 如果一个程序没什么好说的，就沉默"></a>原则11 缄默原则: 如果一个程序没什么好说的，就沉默</h2><p>这个原则，应该是大家最经常破坏的原则之一。一段简短的代码里插入了各种’log(“cmd xxx enter”)’, ‘log(“req data “ + req.String())’，非常害怕自己信息打印得不够。害怕自己不知道程序执行成功了，总要最后’log(“success”)’。但是，我问一下大家，你们真的耐心看过别人写的代码打的一堆日志么？不是自己需要哪个，就在一堆日志里，再打印一个日志出来一个带有特殊标记的日志’log(“this_is_my_log_mark” + xxxxx)’？结果，第一个作者打印的日志，在代码交接给其他人或者在跟别人协作的时候，这个日志根本没有价值，反而提升了大家看日志的难度。</p>
<p>一个服务一跑起来，就疯狂打日志，请求处理正常也打一堆日志。滚滚而来的日志，把错误日志淹没在里面。错误日志失去了效果，简单地tail查看日志，眼花缭乱，看不出任何问题，这不就成了’为了捕获问题’而让自己’根本无法捕获问题’了么？</p>
<p>沉默是金。除了简单的stat log，如果你的程序’发声’了，那么它抛出的信息就一定要有效！打印一个log(‘process fail’)也是毫无价值，到底什么fail了？是哪个用户带着什么参数在哪个环节怎么fail了？如果发声，就要把必要信息给全。不然就是不发声，表示自己好好地work着呢。不发声就是最好的消息，现在我的work一切正常！</p>
<p>“设计良好的程序将用户的注意力视为有限的宝贵资源，只有在必要时才要求使用。”程序员自己的主力，也是宝贵的资源！只有有必要的时候，日志才跑来提醒程序员’我有问题，来看看’，而且，必须要给到足够的信息，让一把讲明白现在发生了什么。而不是程序员还需要很多辅助手段来搞明白到底发生了什么。</p>
<p>每当我发布程序 ，我抽查一个机器，看它的日志。发现只有每分钟外部接入、内部rpc的个数&#x2F;延时分布日志的时候，我就心情很愉悦。我知道，这一分钟，它的陈功率又是100%，没任何问题！</p>
<h2 id="原则12-补救原则-出现异常时，马上退出并给出足够错误信息"><a href="#原则12-补救原则-出现异常时，马上退出并给出足够错误信息" class="headerlink" title="原则12 补救原则: 出现异常时，马上退出并给出足够错误信息"></a>原则12 补救原则: 出现异常时，马上退出并给出足够错误信息</h2><p>其实这个问题很简单，如果出现异常，异常并不会因为我们尝试掩盖它，它就不存在了。所以，程序错误和逻辑错误要严格区分对待。这是一个态度问题。</p>
<p>‘异常是互联网服务器的常态’。逻辑错误通过metrics统计，我们做好告警分析。对于程序错误 ，我们就必须要严格做到在问题最早出现的位置就把必要的信息搜集起来，高调地告知开发和维护者’我出现异常了，请立即修复我!’。可以是直接就没有被捕获的panic了。也可以在一个最上层的位置统一做好recover机制，但是在recover的时候一定要能获得准确异常位置的准确异常信息。不能有中间catch机制，catch之后丢失很多信息再往上传递。</p>
<p>很多Java开发的同学，不区分程序错误和逻辑错误，要么都很宽容，要么都很严格，对代码的可维护性是毁灭性的破坏。”我的程序没有程序错误，如果有，我当时就解决了。”只有这样，才能保持程序代码质量的相对稳定，在火苗出现时扑灭火灾是最好的扑灭火灾的方式。当然，更有效的方式是全面自动化测试的预防：）</p>
<h1 id="具体实践点"><a href="#具体实践点" class="headerlink" title="具体实践点"></a>具体实践点</h1><p>前面提了好多思考方向的问题。大的原则问题和方向。我这里，再来给大家简单列举几个细节执行点吧。毕竟，大家要上手，是从执行开始，然后才是总结思考，能把我的思考方式抄过去。下面是针对golang语言的，其他语言略有不同。以及，我一时也想不全我所执行的 所有细则，这就是我强调’原则’的重要性，原则是可枚举的。</p>
<ul>
<li><p>对于代码格式规范，100%严格执行，严重容不得一点沙。</p>
</li>
<li><p>文件绝不能超过800行，超过，一定要思考怎么拆文件。工程思维，就在于拆文件的时候积累。</p>
</li>
<li><p>函数对决不能超过80行，超过，一定要思考怎么拆函数，思考函数分组，层次。工程思维，就在于拆文件的时候积累。</p>
</li>
<li><p>代码嵌套层次不能超过4层，超过了就得改。多想想能不能early return。工程思维，就在于拆文件的时候积累。</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !needContinue &#123;</span><br><span class="line">	doA()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	doB()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !needContinue &#123;</span><br><span class="line">	doA()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doB()</span><br><span class="line"><span class="keyword">return</span></span><br></pre></td></tr></table></figure>
<p>下面这个就是early return，把两端代码从逻辑上解耦了。</p>
<ul>
<li>从目录、package、文件、struct、function一层层下来 ，信息一定不能出现冗余。比如file.FileProperty这种定义。只有每个’定语’只出现在一个位置，才为’做好逻辑、定义分组&#x2F;分层’提供了可能性。</li>
<li>多用多级目录来组织代码所承载的信息，即使某一些中间目录只有一个子目录。</li>
<li>随着代码的扩展，老的代码违反了一些设计原则，应该立即原地局部重构，维持住代码质量不滑坡。比如:拆文件；拆函数；用Session来保存一个复杂的流程型函数的所有信息；重新调整目录结构。</li>
<li>基于上一点考虑，我们应该尽量让项目的代码有一定的组织、层次关系。我个人的当前实践是除了特别通用的代码，都放在一个git里。特别通用、修改少的代码，逐渐独立出git，作为子git连接到当前项目git，让goland的Refactor特性、各种Refactor工具能帮助我们快速、安全局部重构。</li>
<li>自己的项目代码，应该有一个内生的层级和逻辑关系。flat平铺展开是非常不利于代码复用的。怎么复用、怎么组织复用，肯定会变成’人生难题’。T4-T7的同学根本无力解决这种难题。</li>
<li>如果被review的代码虽然简短，但是你看了一眼却发现不咋懂，那就一定有问题。自己看不出来，就找高级别的同学交流。这是你和别review代码的同学成长的时刻。</li>
<li>日志要少打。要打日志就要把关键索引信息带上。必要的日志必须打。</li>
<li>有疑问就立即问，不要怕问错。让代码作者给出解释。不要怕问出极低问题。</li>
<li>不要说’建议’，提问题，就是刚，你pk不过我，就给改！</li>
<li>请积极使用trpc。总是要和老板站在一起！只有和老板达成的对于代码质量建设的共识，才能在团队里更好地做好代码质量建设。</li>
<li>消灭重复！消灭重复！消灭重复！</li>
</ul>
<h1 id="主干开发"><a href="#主干开发" class="headerlink" title="主干开发"></a>主干开发</h1><p>最后，我来为’主干开发’多说一句话。道理很简单，只有每次被review代码不到500行，reviewer才能快速地看完，而且几乎不会看漏。超过500行，reviewer就不能仔细看，只能大概浏览了。而且，让你调整500行代码内的逻辑比调整3000行甚至更多的代码，容易很多，降低不仅仅是6倍，而是一到两个数量级。有问题，在刚出现的时候就调整了，不会给被revew的人带来大的修改负担。</p>
<p>关于CI(continuous integration)，还有很多好的资料和书籍，大家应该及时去学习学习。</p>
<h1 id="《unix编程艺术》"><a href="#《unix编程艺术》" class="headerlink" title="《unix编程艺术》"></a>《unix编程艺术》</h1><p>建议大家把这本书找出来读一读。特别是，T7及更高级别的同学。你们已经积累了大量的代码实践，亟需对’工程性’做思考总结。很多工程方法论都过时了，这本书的内容，是例外中的例外。它所表达出的内容没有因为软件技术的不断更替而过时。</p>
<p>佛教禅宗讲’不立文字’(不立文字，教外别传，直指人心，见性成佛)，很多道理和感悟是不能用文字传达的，文字的表达能力，不能表达。大家尝尝因为”自己听说过、知道某个道理”而产生一种安心感，认为”我懂了这个道理”，但是自己却不能在实践中做到。知易行难，知道却做不到，在工程实践里，就和’不懂这个道理’没有任何区别了。</p>
<p>曾经，我面试过一个别的公司的总监，讲得好像一套一套，代码拉出来遛一遛，根本就没做到，仅仅会道听途说。他在工程实践上的探索前路可以说已经基本断绝了。我只能祝君能做好向上管理，走自己的纯管理道路吧。请不要再说自己对技术有追求，是个技术人了！</p>
<p>所以，大家不仅仅是看看我这篇文章，而是在实践中去不断践行和积累自己的’教外别传’吧。</p>
<p><a target="_blank" rel="noopener" href="https://www.oreilly.com/library/view/software-engineering-at/9781492082781/">Software Engineering at Google</a>也是一本必读好书，可惜没找到中文翻译。(电子版放附件里了)</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">devin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/04/28/TreasureBox/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/code%20review%E6%80%BB%E7%BB%93/">http://example.com/2023/04/28/TreasureBox/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/code%20review%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">devin's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/28/TreasureBox/%E6%80%BB%E7%BB%93/2.%E5%8D%87%E5%93%B2%E7%A7%91%E6%8A%80/" title="升哲科技"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">升哲科技</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/28/TreasureBox/%E6%80%BB%E7%BB%93/1.tencent/" title="tencent"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">tencent</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">devin</div><div class="author-info__description">分享技术知识</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">151</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liuhuanxg"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%8A%80%E6%9C%AF%E4%BA%BA%E5%91%98%E5%8C%85%E6%8B%ACleader%E9%83%BD%E8%A6%81%E5%81%9Acode-review"><span class="toc-number">2.</span> <span class="toc-text">为什么技术人员包括leader都要做code review</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%8C%E5%AD%A6%E4%BB%AC%E8%A6%81%E5%9C%A8review%E4%B8%AD%E6%80%9D%E8%80%83%E5%92%8C%E6%80%BB%E7%BB%93%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.</span> <span class="toc-text">为什么同学们要在review中思考和总结最佳实践</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%8F%98%E5%9D%8F%E7%9A%84%E6%A0%B9%E6%BA%90"><span class="toc-number">4.</span> <span class="toc-text">代码变坏的根源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">重复的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A9%E6%9C%9F%E6%9C%89%E6%95%88%E7%9A%84%E5%86%B3%E7%AD%96%E4%B8%8D%E5%86%8D%E6%9C%89%E6%95%88"><span class="toc-number">4.2.</span> <span class="toc-text">早期有效的决策不再有效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%97%A9%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">4.3.</span> <span class="toc-text">过早的优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E5%90%88%E7%90%86%E6%80%A7%E6%B2%A1%E6%9C%89%E8%8B%9B%E6%B1%82"><span class="toc-number">4.4.</span> <span class="toc-text">对合理性没有苛求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B9%E6%9C%AC%E6%B2%A1%E6%9C%89%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.5.</span> <span class="toc-text">根本没有设计</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%85%E9%A1%BB%E5%BD%A2%E8%80%8C%E4%B8%8A%E7%9A%84%E6%80%9D%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">必须形而上的思考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#model%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text">model设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UNIX%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6"><span class="toc-number">7.</span> <span class="toc-text">UNIX设计哲学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Keep-It-Simple-Stuped"><span class="toc-number">7.1.</span> <span class="toc-text">Keep It Simple Stuped!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%88%993-%E7%BB%84%E5%90%88%E5%8E%9F%E5%88%99-%E8%AE%BE%E8%AE%A1%E6%97%B6%E8%80%83%E8%99%91%E6%8B%BC%E6%8E%A5%E7%BB%84%E5%90%88"><span class="toc-number">7.2.</span> <span class="toc-text">原则3 组合原则: 设计时考虑拼接组合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%88%996-%E5%90%9D%E5%95%AC%E5%8E%9F%E5%88%99-%E9%99%A4%E9%9D%9E%E7%A1%AE%E6%97%A0%E5%AE%83%E6%B3%95-%E4%B8%8D%E8%A6%81%E7%BC%96%E5%86%99%E5%BA%9E%E5%A4%A7%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">7.3.</span> <span class="toc-text">原则6 吝啬原则: 除非确无它法, 不要编写庞大的程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%88%997-%E9%80%8F%E6%98%8E%E6%80%A7%E5%8E%9F%E5%88%99-%E8%AE%BE%E8%AE%A1%E8%A6%81%E5%8F%AF%E8%A7%81%EF%BC%8C%E4%BB%A5%E4%BE%BF%E5%AE%A1%E6%9F%A5%E5%92%8C%E8%B0%83%E8%AF%95"><span class="toc-number">7.4.</span> <span class="toc-text">原则7 透明性原则: 设计要可见，以便审查和调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%88%9910-%E9%80%9A%E4%BF%97%E5%8E%9F%E5%88%99-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%E9%81%BF%E5%85%8D%E6%A0%87%E6%96%B0%E7%AB%8B%E5%BC%82"><span class="toc-number">7.5.</span> <span class="toc-text">原则10 通俗原则: 接口设计避免标新立异</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%88%9911-%E7%BC%84%E9%BB%98%E5%8E%9F%E5%88%99-%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%E6%B2%A1%E4%BB%80%E4%B9%88%E5%A5%BD%E8%AF%B4%E7%9A%84%EF%BC%8C%E5%B0%B1%E6%B2%89%E9%BB%98"><span class="toc-number">7.6.</span> <span class="toc-text">原则11 缄默原则: 如果一个程序没什么好说的，就沉默</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%88%9912-%E8%A1%A5%E6%95%91%E5%8E%9F%E5%88%99-%E5%87%BA%E7%8E%B0%E5%BC%82%E5%B8%B8%E6%97%B6%EF%BC%8C%E9%A9%AC%E4%B8%8A%E9%80%80%E5%87%BA%E5%B9%B6%E7%BB%99%E5%87%BA%E8%B6%B3%E5%A4%9F%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">7.7.</span> <span class="toc-text">原则12 补救原则: 出现异常时，马上退出并给出足够错误信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E8%B7%B5%E7%82%B9"><span class="toc-number">8.</span> <span class="toc-text">具体实践点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E5%B9%B2%E5%BC%80%E5%8F%91"><span class="toc-number">9.</span> <span class="toc-text">主干开发</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%80%8Aunix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF%E3%80%8B"><span class="toc-number">10.</span> <span class="toc-text">《unix编程艺术》</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/28/hello-world/" title="Hello World">Hello World</a><time datetime="2023-04-28T10:44:48.968Z" title="发表于 2023-04-28 18:44:48">2023-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/28/TreasureBox/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/1%E3%80%81TCPIP%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/" title="1、TCPIP网络模型">1、TCPIP网络模型</a><time datetime="2023-04-28T10:40:04.953Z" title="发表于 2023-04-28 18:40:04">2023-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/28/TreasureBox/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95/" title="算法">算法</a><time datetime="2023-04-28T10:40:04.944Z" title="发表于 2023-04-28 18:40:04">2023-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/28/TreasureBox/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kafka/1.kafka%E8%AF%A6%E8%A7%A3/" title="kafka详解">kafka详解</a><time datetime="2023-04-28T10:40:04.944Z" title="发表于 2023-04-28 18:40:04">2023-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/28/TreasureBox/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%88%9D%E8%AF%86/" title="数据结构初识">数据结构初识</a><time datetime="2023-04-28T10:40:04.943Z" title="发表于 2023-04-28 18:40:04">2023-04-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By devin</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>